# Real-time Object XYZ Tracking (โปรแกรมติดตามวัตถุ XYZ แบบเรียลไทม์)

## คำอธิบายโปรเจกต์ (Project Description)

โปรแกรมนี้ใช้สำหรับตรวจจับวัตถุเป้าหมายที่กำหนด (เช่น บุคคล, แป้นบาส) แบบเรียลไทม์ผ่านกล้อง (รองรับ Webcam, Intel RealSense, หรือไฟล์วิดีโอ) จากนั้นคำนวณตำแหน่ง 3 มิติ (X, Y, Z) ของวัตถุเทียบกับกล้อง และคำนวณมุมในแนวนอน (Angle (XZ)) ที่หุ่นยนต์/กล้องต้องหมุนเพื่อหันหน้าเข้าหาวัตถุนั้น

โปรแกรมใช้โมเดล YOLO ในการตรวจจับวัตถุ และใช้ Intel RealSense หรือโมเดล Regression (PyCaret) ที่เทรนไว้ (ถ้ามี) ในการประมาณค่าความลึก (Z) โค้ดถูกแบ่งออกเป็นโมดูลย่อยๆ เพื่อให้ง่ายต่อการจัดการและพัฒนาต่อ

## การติดตั้ง (Installation)

1.  **สร้าง Virtual Environment (แนะนำ):**
    ```bash
    python -m venv venv
    # Activate environment (Windows)
    .\venv\Scripts\activate
    # Activate environment (Linux/macOS)
    source venv/bin/activate
    ```
2.  **ติดตั้ง Dependencies:** ตรวจสอบว่ามีไฟล์ `requirements.txt` ที่ถูกต้อง (ดูหมายเหตุในไฟล์ `requirements.txt` เกี่ยวกับการสร้างเวอร์ชันที่แน่นอน) แล้วรันคำสั่ง:
    ```bash
    pip install -r requirements.txt
    ```
    - **สำคัญ (สำหรับ GPU):** หากต้องการใช้ GPU ต้องแน่ใจว่าได้ติดตั้ง `torch` และ `torchvision` เวอร์ชันที่รองรับ CUDA โดยใช้คำสั่งจากเว็บไซต์ PyTorch ([https://pytorch.org/get-started/locally/](https://pytorch.org/get-started/locally/)) และได้ติดตั้ง CUDA Toolkit กับ cuDNN ที่เข้ากันได้แล้ว

## การตั้งค่า (Configuration)

การตั้งค่าหลักของโปรแกรมอยู่ในไฟล์ `config.py` ตรวจสอบและแก้ไขค่าต่างๆ ให้ถูกต้องก่อนรัน:

- `YOLO_MODEL_PATH`: ตำแหน่งไฟล์โมเดล YOLO (.pt)
- `DEPTH_MODEL_PATH`: ตำแหน่งไฟล์โมเดล Regression (.pkl) (ถ้าใช้)
- `TARGET_CLASS_NAME`: ชื่อคลาสของวัตถุเป้าหมาย (ต้องตรงกับในโมเดล YOLO)
- `CONF_THRESHOLD`: ค่าความมั่นใจขั้นต่ำของ YOLO
- `CAMERA_ID`: ID ของ Webcam (ปกติคือ 0)
- `FRAME_WIDTH`, `FRAME_HEIGHT`, `FPS`: การตั้งค่าความละเอียดและ FPS ของกล้อง
- `VIDEO_FILE_PATH`: ตำแหน่งไฟล์วิดีโอ (ถ้าเลือกโหมดวิดีโอ)
- ค่าอื่นๆ เกี่ยวกับการประมาณค่า Depth สำรอง และการแสดงผล

## วิธีใช้งาน (Usage)

1.  **Activate Environment:** (ถ้าสร้างไว้)
    ```bash
    # Windows: .\venv\Scripts\activate
    # Linux/macOS: source venv/bin/activate
    ```
2.  **รันโปรแกรม:**
    ```bash
    python main.py
    ```
3.  **เลือกแหล่งภาพ:** โปรแกรมจะถามให้เลือกแหล่งภาพตอนเริ่มต้น (A: RealSense, B: Webcam, C: Video) พิมพ์ตัวอักษรแล้วกด Enter
4.  **การทำงาน:**
    - หน้าต่างจะแสดงภาพจากกล้อง พร้อมแกน X,Y,Z ที่ Origin
    - หากตรวจพบวัตถุเป้าหมาย จะมีกรอบสีเขียว, ป้ายชื่อ, สัญลักษณ์ Target สีเหลือง และเส้นเชื่อมจาก Origin
    - มุมซ้ายล่างแสดงข้อมูล: ตำแหน่ง (Pos: X,Y,Z), ระยะทาง (Dist), และมุมที่ต้องหมุน (Angle: XZ)
    - มุมซ้ายบนแสดง Mode และ FPS
    - Z เป็นความลึก (Depth) เป็นระยะทางที่วัดตั้งฉากจากระนาบของเลนส์กล้อง (แกน Z ของกล้อง ซึ่งพุ่งตรงไปข้างหน้า) ไปยังวัตถุ (แป้นบาส) โดยตรง ถ้าวัตถุอยู่ตรงหน้าพอดี ค่า Z กับ Dist จะใกล้เคียงกัน แต่ถ้าวัตถุอยู่เยื้องไปทางซ้าย/ขวา/บน/ล่าง ค่า Z คือระยะ "ตรงๆ" ไปข้างหน้าจนถึงระนาบเดียวกับวัตถุ
    - Dist หมายถึง ระยะทางจริง 3 มิติ (Euclidean Distance) เป็นระยะทางเส้นตรงที่วัดจากจุดศูนย์กลางของกล้อง (Origin) ไปยังจุดศูนย์กลางของวัตถุ (แป้นบาส) โดยตรง เหมือนการขึงเส้นเชือกตรงๆ จากกล้องไปหาวัตถุ ค่านี้จะคำนวณจาก X, Y, และ Z โดยใช้ทฤษฎีบทพีทาโกรัสใน 3 มิติ
5.  **การควบคุม:**
    - กด `q`: เพื่อออกจากโปรแกรม

## ข้อจำกัด / ปัญหาที่ทราบ (Known Issues / Limitations)

- **ประสิทธิภาพ (FPS):** ความเร็วขึ้นอยู่กับ Hardware และขนาดโมเดล YOLO (เร็วขึ้นมากหากใช้ GPU เเทน CPU)
- **ความแม่นยำ Depth:** ขึ้นอยู่กับวิธีที่ใช้ (RealSense > Regression Model > Estimation)
- **Calibration:** เพื่อความแม่นยำสูงสุด ควรทำการ Calibrate กล้อง
